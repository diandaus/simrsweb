# ============================================
# Apache Virtual Host Configuration
# SIMRS Khanza Web - Backend API
# ============================================
# 
# CARA PENGGUNAAN:
# 1. Copy file ini ke /etc/apache2/sites-available/simrs-web-api.conf
# 2. Edit ServerName sesuai domain/IP Anda
# 3. Edit DocumentRoot jika path berbeda
# 4. Aktifkan: sudo a2ensite simrs-web-api.conf
# 5. Restart: sudo systemctl restart apache2
#
# ============================================

<VirtualHost *:80>
    # Ganti dengan domain atau IP server Anda
    ServerName api.simrs.local
    # Atau jika menggunakan IP:
    # ServerName 192.168.1.100
    
    # Path ke folder public Laravel
    DocumentRoot /var/www/simrs-web/backend/public

    <Directory /var/www/simrs-web/backend/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Laravel specific
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^ index.php [L]
        </IfModule>
    </Directory>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/simrs-web-api-error.log
    CustomLog ${APACHE_LOG_DIR}/simrs-web-api-access.log combined
    
    # Security headers
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
</VirtualHost>

# ============================================
# SIMRS Khanza Web - Frontend
# ============================================
# 
# Copy ke: /etc/apache2/sites-available/simrs-web.conf
#

<VirtualHost *:80>
    # Ganti dengan domain atau IP server Anda
    ServerName simrs.local
    # Atau jika menggunakan IP:
    # ServerName 192.168.1.100
    
    # Path ke folder dist hasil build frontend
    DocumentRoot /var/www/simrs-web/frontend/dist

    <Directory /var/www/simrs-web/frontend/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Vue Router - Fallback ke index.html
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/simrs-web-error.log
    CustomLog ${APACHE_LOG_DIR}/simrs-web-access.log combined
    
    # Security headers
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
</VirtualHost>

# ============================================
# OPSI: Single Virtual Host (Backend + Frontend)
# ============================================
# Jika ingin menggunakan satu domain untuk keduanya
# Uncomment dan sesuaikan:

# <VirtualHost *:80>
#     ServerName simrs.local
#     DocumentRoot /var/www/simrs-web/frontend/dist
# 
#     # Frontend
#     <Directory /var/www/simrs-web/frontend/dist>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         <IfModule mod_rewrite.c>
#             RewriteEngine On
#             RewriteBase /
#             RewriteRule ^index\.html$ - [L]
#             RewriteCond %{REQUEST_FILENAME} !-f
#             RewriteCond %{REQUEST_FILENAME} !-d
#             RewriteRule . /index.html [L]
#         </IfModule>
#     </Directory>
# 
#     # Backend API - Alias
#     Alias /api /var/www/simrs-web/backend/public
#     <Directory /var/www/simrs-web/backend/public>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         <IfModule mod_rewrite.c>
#             RewriteEngine On
#             RewriteBase /api
#             RewriteCond %{REQUEST_FILENAME} !-f
#             RewriteCond %{REQUEST_FILENAME} !-d
#             RewriteRule ^ /api/index.php [L]
#         </IfModule>
#     </Directory>
# 
#     ErrorLog ${APACHE_LOG_DIR}/simrs-web-error.log
#     CustomLog ${APACHE_LOG_DIR}/simrs-web-access.log combined
# </VirtualHost>

